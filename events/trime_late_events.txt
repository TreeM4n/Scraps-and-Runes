###########
# trime_late_events
# made by:
# tr33
#
###########
namespace = trime
country_event = {
	id = trime.100
	title = "trime.100.name"
	desc = "trime.100.desc"
	picture = GFX_evt_ringworld
	show_sound = event_conversation
	location = from.capital_scope
	trigger = {
		exists = event_target:trime_time_lord
		#has_any_megastructure = yes
		has_global_flag = trime_system_spawned
	}
	is_triggered_only = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = event_target:trime_time_lord
	}
	# Halts the ring world construction
	option = {
		name = trime.100.a
		#custom_tooltip = trime.100.a.tooltip
		ai_chance = {
			factor = 10
		}
		random_owned_megastructure = {
			limit = {
				is_upgrading = yes
			}
			set_halted = 360
		}
		event_target:trime_time_lord = {
			add_age = 36
		}
	}
	option = {
		name = trime.100.b
		allow = {
			resource_stockpile_compare = {
				resource = influence
				value > 200
			}
		}
		ai_chance = {
			factor = 10
		}
		add_resource = {
			influence = -200
		}
	}
}

country_event = {
	id = trime.99
	hide_window = yes
	location = from.capital_scope
	trigger = {
		exists = event_target:trime_time_lord
		#has_any_megastructure = yes
		has_global_flag = trime_system_spawned
	}
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				has_country_flag = trime_instant_mega
				from = {
					NOT = {
						is_megastructure_type = gateway_0
					}
				}
			}
			from = {
				finish_upgrade = yes
			}
			remove_country_flag = trime_instant_mega
		}
		else = {
			random_list = {
				95 = {
				}
				5 = {
					this = {
						country_event = {
							id = trime.100
						}
					}
				}
			}
		}
	}
}

event = {
	id = trime.101
	hide_window = yes
	#location = from.capital_scope
	trigger = {
		exists = event_target:trime_time_lord
		#has_any_megastructure = yes
		has_global_flag = trime_system_spawned
		exists = event_target:trime_time_lord.owner
		NOT = {
			has_global_flag = trime_time_lorddiedfr
		}
	}
	is_triggered_only = yes
	immediate = {
		event_target:trime_time_lord = {
			if = {
				limit = {
					check_variable_arithmetic = {
						which = this.trigger:leader_age
						#mult = 100				
						value >= 3
					}
				}
				add_age = -2
			}
			else = {
				set_global_flag = trime_time_lorddiedfr
				root = {
					country_event = {
						id = trime.106
					}
				}
			}
			trime_setportrait = yes
		}
	}
}

event = {
	id = trime.102
	hide_window = yes
	#location = from.capital_scope
	trigger = {
		exists = event_target:trime_time_lord
		#has_any_megastructure = yes
		has_global_flag = trime_system_spawned
		exists = event_target:trime_time_lord.owner
		NOT = {
			has_global_flag = trime_time_lorddiedfr
		}
	}
	is_triggered_only = yes
	immediate = {
		switch = {
			trigger = has_global_flag
			trime_stage1 = {
				remove_global_flag = trime_stage1
				set_global_flag = trime_stage2
			}
			trime_stage2 = {
				remove_global_flag = trime_stage2
				set_global_flag = trime_stage3
			}
			trime_stage3 = {
				remove_global_flag = trime_stage3
				set_global_flag = trime_stage4
			}
			trime_stage4 = {
				remove_global_flag = trime_stage4
				set_global_flag = trime_stage5
			}
			trime_stage5 = {
				remove_global_flag = trime_stage5
				set_global_flag = trime_stage1
			}
			default = {
				set_global_flag = trime_stage1
			}
		}
		event_target:trime_time_lord = {
			if = {
				limit = {
					this.owner = {
						has_relic = r_trime_houglass
					}
				}
				this.owner = {
					while = {
						count = 3
						random_owned_leader = {
							limit = {
								NOR = {
									has_trait = trime_leader_trait_exhaustion
									has_trait = trime_leader_trait_legendary_timeskipper
								}
							}
							add_timed_trait = {
								trait = trime_leader_trait_exhaustion
								days = 720
							}
							add_age = -5
							event_target:trime_time_lord = {
								add_age = 10
							}
						}
					}
				}
				create_message = {
					type = trime_hourglass_tick
					localization = this
					days = 30
				}
			}
			else = {
			}
		}
	}
}

# relic lost 
# scope 
country_event = {
	id = trime.103
	hide_window = yes
	#location = from.capital_scope
	trigger = {
		exists = event_target:trime_time_lord
		#has_any_megastructure = yes
		has_global_flag = trime_system_spawned
		has_relic = r_trime_houglass
		exists = event_target:trime_time_lord.owner
	}
	is_triggered_only = yes
	immediate = {
		event_target:trime_time_lord.owner = {
			#
			if = {
				limit = {
					NOT = {
						has_relic = r_trime_houglass
					}
				}
				#dd_relic =
				country_event = {
					#add relic
					id = trime.104
				}
				root = {
					country_event = {
						#remove relic
						id = trime.105
					}
				}
			}
		}
	}
}

country_event = {
	id = trime.105
	title = "trime.105.name"
	desc = "trime.105.desc"
	picture = GFX_evt_ancient_artifact
	show_sound = event_bad_omen
	location = from.capital_scope
	trigger = {
		#exists = event_target:trime_time_lord		
		#has_global_flag = trime_system_spawned
	}
	is_triggered_only = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = event_target:trime_time_lord
	}
	option = {
		name = trime.105.a
		remove_relic = r_trime_houglass
		every_owned_leader = {
			limit = {
				leader_age > 50
			}
			add_age = -50
		}
	}
}

country_event = {
	id = trime.104
	title = "trime.104.name"
	desc = "trime.104.desc"
	picture = GFX_evt_one_sided_deal
	show_sound = event_finding_loot
	location = from.capital_scope
	trigger = {
		#exists = event_target:trime_time_lord		
		#has_global_flag = trime_system_spawned
	}
	is_triggered_only = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = event_target:trime_time_lord
	}
	option = {
		name = trime.104.a
		add_relic = r_trime_houglass
	}
}

country_event = {
	id = trime.106
	title = "trime.106.name"
	desc = "trime.106.desc"
	picture = GFX_evt_zro_4
	show_sound = par_notification_leader_death
	location = from.capital_scope
	trigger = {
		#exists = event_target:trime_time_lord		
		#has_global_flag = trime_system_spawned
	}
	is_triggered_only = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = event_target:trime_time_lord
	}
	option = {
		name = trime.106.a
		hidden_effect = {
			set_variable = {
				which = trime_death_age
				value = event_target:trime_time_lord.trigger:leader_age
			}
			#event_target:trime_time_lord = {
			#	clone_leader = {
			#		target = THIS
			#	}
			#	last_created_leader = {
			#		exile_leader_as = trime_time_lord_exile
			#		save_global_event_target_as = trime_time_lord_exile
			#	}
			#}
		}
		event_target:trime_time_lord = {
			kill_leader = {
				show_notification = yes
			}
		}
	}
}

country_event = {
	id = trime.107
	hide_window = yes
	trigger = {
		has_global_flag = trime_system_spawned
		has_country_flag = trime_future_war
	}
	is_triggered_only = yes
	immediate = {
		create_fleet_from_naval_cap = 0.25
		remove_country_flag = trime_future_war
		create_message = {
			type = trime_future_fleet_arrived
			localization = trime_future_fleet_arrived_loc
			days = 30
		}
	}
}

country_event = {
	id = trime.108
	hide_window = yes
	trigger = {
		has_global_flag = trime_system_spawned
		OR = {
			has_country_flag = trime_instant_relic_2
			has_country_flag = trime_instant_relic_1
		}
		has_modifier = relic_activation_cooldown
	}
	is_triggered_only = yes
	immediate = {
		remove_modifier = relic_activation_cooldown
		if = {
			limit = {
				has_country_flag = trime_instant_relic_2
			}
			remove_country_flag = trime_instant_relic_2
			set_country_flag = trime_instant_relic_1
		}
		else = {
			remove_country_flag = trime_instant_relic_1
		}
	}
}

country_event = {
	id = trime.109
	title = "trime.109.name"
	desc = "trime.109.desc"
	show_sound = event_conversation
	#location = fromfrom
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = "trime_window"
	immediate = {
		event_target:trime_time_lord = {
			set_variable = {
				which = trime_death_age
				value = this.trigger:leader_age
			}
		}
	}
	picture_event_data = {
		portrait = event_target:trime_time_lord
		room = trime_background_room
	}
	option = {
		name = LEAVE
		#custom_tooltip = trime_thisisugly
	}
}

# return timelord  trime_death_age
country_event = {
	id = trime.110
	title = "trime.110.name"
	desc = "trime.110.desc"
	picture = GFX_evt_ringworld
	show_sound = event_conversation
	location = from.capital_scope
	trigger = {
		exists = event_target:trime_time_lord
		#has_any_megastructure = yes
		has_global_flag = trime_system_spawned
	}
	is_triggered_only = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = event_target:trime_time_lord
	}
	# returns leader
	option = {
		name = trime.110.a
		#custom_tooltip = trime.100.a.tooltip
		ai_chance = {
			factor = 10
		}
		#trime_time_lord_exile
		hidden_effect = {
			create_country = {
				name = "NAME_Unknown"
				type = global_event
				auto_delete = yes
				flag = {
					icon = {
						category = "special"
						file = "unknown.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"red"
						"red"
						"null"
						"null"
					}
				}
				effect = {
					save_event_target_as = trime_country
				}
			}
			event_target:trime_country = {
				create_species = {
					name = "NAME_Unknown"
					class = PARAGON
					portrait = GFX_trime_time_lord
					namelist = "PRT1"
					traits = {
						trait = trait_decadent
						trait = trait_talented
						trait = trait_thrifty
						#trait = trait_weak
						#trait = trait_plantoid_budding
					}
					effect = {
						save_event_target_as = trime_species
					}
				}
				create_leader = {
					species = event_target:trime_species
					event_leader = yes
					class = scientist
					name = "NAME_trime_time_lord"
					skill = 1
					randomize_traits = no
					skip_background_generation = yes
					background_ethic = ethic_authoritarian
					custom_catch_phrase = trime_time_lord_catchphrase
					custom_description = trime_time_lord_backstory
					can_manually_change_location = yes
					#traits = {
					#	trait = trime_leader_trait_legendary_timeskipper
					#trait = leader_trait_xeno_cataloger
					#trait = leader_trait_educator
					#	trait = leader_trait_lavish_lifestyle_2
					#	trait = leader_trait_adaptable_2
					#	trait = subclass_scientist_councilor
					#}
					gender = male
					set_age = 137
					immortal = yes
					effect = {
						save_global_event_target_as = trime_time_lord
						set_leader_flag = legendary_leader
						set_leader_flag = trime_time_lord
						set_owner = root
						exile_leader_as = trime_time_lord
					}
				}
				last_created_leader = {
					add_skill_without_trait_selection = 6
					#set_variable = {
					#	which = trime_leader_lifespan
					##	value = 137
					#}
					remove_all_traits = yes
					add_trait = trime_leader_trait_legendary_timeskipper
					add_trait = trime_leader_trait_legendary_houtglasskeeper
					add_trait = leader_trait_lavish_lifestyle_2
					add_trait = leader_trait_adaptable_2
					add_trait = subclass_scientist_governor
					add_trait = leader_trait_great_researcher
					set_owner = root
				}
			}
		}
		last_created_leader = {
			set_owner = root
		}
		remove_global_flag = trime_time_lorddied
	}
}

country_event = {
	id = trime.111
	hide_window = yes
	trigger = {
		has_global_flag = trime_system_spawned
		from = {
			has_trait = trime_leader_trait_legendary_timeskipper
		}
	}
	is_triggered_only = yes
	immediate = {
		set_global_flag = trime_time_lorddiedfr
	}
}

country_event = {
	id = trime.112
	hide_window = yes
	trigger = {
		has_global_flag = trime_system_spawned
		from = {
			has_trait = trime_leader_trait_legendary_timeskipper
		}
	}
	is_triggered_only = yes
	immediate = {
		set_variable = {
			which = trime_death_age
			value = event_target:trime_time_lord.trigger:leader_age
		}
		event_target:trime_time_lord = {
			clone_leader = {
				target = THIS
			}
			last_created_leader = {
				exile_leader_as = trime_time_lord_exile
				save_global_event_target_as = trime_time_lord_exile
			}
		}
		set_global_flag = trime_time_lorddied
	}
}

leader_event = {
	id = trime.115
	title = trime.115.name
	desc = trime.115.desc
	picture = GFX_evt_tradestation_interior
	show_sound = cute_molluscoid_starfish_greetings
	is_triggered_only = yes
	#fire_only_once = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = root
	}
	immediate = {
		if = {
			limit = {
				exists = planet
			}
			planet = {
				save_event_target_as = planet_governed
			}
		}
		else = {
			owner.capital_scope = {
				save_event_target_as = planet_governed
			}
		}
	}
	option = {
		name = trime.115.a
		event_target:planet_governed = {
			add_modifier = {
				modifier = trime_cursedworld
				years = 5
			}
		}
		this = {
			add_age = 20
		}
	}
	option = {
		name = trime.115.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = influence
					value > 100
				}
			}
		}
		owner = {
			add_resource = {
				influence = -100
			}
		}
	}
	option = {
		name = trime.115.c
		allow = {
			this = {
				leader_age > 30
			}
		}
		event_target:planet_governed = {
			add_modifier = {
				modifier = trime_blessedworld
				years = 5
			}
		}
		this = {
			add_age = -20
		}
	}
}

leader_event = {
	id = trime.116
	title = trime.116.name
	desc = trime.116.desc
	picture = GFX_evt_robot_assembly_plant
	show_sound = cute_molluscoid_starfish_greetings
	is_triggered_only = yes
	#fire_only_once = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = root
	}
	immediate = {
		if = {
			limit = {
				exists = planet
			}
			planet = {
				save_event_target_as = planet_governed
			}
		}
		else = {
			owner.capital_scope = {
				save_event_target_as = planet_governed
			}
		}
	}
	option = {
		name = trime.116.a
		event_target:planet_governed = {
			add_modifier = {
				modifier = trime_slowgrowing
				years = 5
			}
		}
		this = {
			add_age = 20
		}
	}
	option = {
		name = trime.116.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = influence
					value > 100
				}
			}
		}
		owner = {
			add_resource = {
				influence = -100
			}
		}
	}
	option = {
		name = trime.116.c
		allow = {
			this = {
				leader_age > 30
			}
		}
		event_target:planet_governed = {
			add_modifier = {
				modifier = trime_speedgrowing
				years = 5
			}
		}
		this = {
			add_age = -20
		}
	}
}

leader_event = {
	id = trime.117
	title = trime.117.name
	desc = trime.117.desc
	picture = GFX_evt_ruined_system
	show_sound = cute_molluscoid_starfish_greetings
	is_triggered_only = yes
	#fire_only_once = yes
	trigger = {
		owner = {
			any_owned_megastructure = {
				is_upgrading = yes
			}
		}
	}
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = root
	}
	immediate = {
		owner = {
			random_owned_megastructure = {
				limit = {
					is_upgrading = yes
				}
				save_event_target_as = trime_nomegaforu
			}
		}
	}
	option = {
		name = trime.117.a
		event_target:trime_nomegaforu = {
			set_halted = 720
		}
		this = {
			add_age = 100
		}
	}
	option = {
		name = trime.117.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = influence
					value > 100
				}
			}
		}
		owner = {
			add_resource = {
				influence = -100
			}
		}
	}
}

leader_event = {
	id = trime.118
	title = trime.118.name
	desc = trime.118.desc
	picture = GFX_evt_surreal_visions
	show_sound = cute_molluscoid_starfish_greetings
	is_triggered_only = yes
	#fire_only_once = yes
	trigger = {
		owner = {
			count_situation = {
				count > 0
			}
		}
	}
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = root
	}
	immediate = {
		owner = {
			random_situation = {
				save_event_target_as = trime_situationlmao
			}
		}
	}
	option = {
		name = trime.118.a
		event_target:trime_situationlmao = {
			add_situation_progress = 30
		}
	}
	option = {
		# i hope this breaks a lot xd
		name = trime.118.b
		allow = {
			event_target:trime_situationlmao = {
				situation_progress > 30
			}
		}
		event_target:trime_situationlmao = {
			add_situation_progress = -30
		}
	}
}

leader_event = {
	id = trime.119
	title = trime.119.name
	desc = trime.119.desc
	picture = GFX_evt_unidentified_ship
	show_sound = cute_molluscoid_starfish_greetings
	is_triggered_only = yes
	#fire_only_once = yes
	trigger = {
		owner = {
			num_fleets > 0
		}
	}
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = root
	}
	immediate = {
		owner = {
			random_owned_fleet = {
				save_event_target_as = trime_fleet
			}
		}
	}
	option = {
		name = trime.119.a
		event_target:trime_fleet = {
			set_mia = mia_emergency_ftl
		}
	}
	option = {
		name = trime.119.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = influence
					value > 100
				}
			}
		}
		owner = {
			add_resource = {
				influence = -100
			}
		}
	}
}

# Fires from on_decade_pulse_country
event = {
	id = trime.113
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		#has_paragon_dlc = yes
		exists = event_target:trime_time_lord
		has_global_flag = trime_system_spawned
		#has_relic = r_trime_houglass
		exists = event_target:trime_time_lord.owner
	}
	immediate = {
		event_target:trime_time_lord = {
			random_list = {
				5 = {
					leader_event = {
						id = trime.114
						days = 1
						random = 900
					}
				}
				# age leader
				10 = {
					leader_event = {
						id = trime.115
						days = 1
						random = 900
					}
				}
				# production up
				#5 = { leader_event = { id = paragon.40120 days = 1 random = 900 } } # production down
				5 = {
					leader_event = {
						id = trime.116
						days = 1
						random = 900
					}
				}
				# speed growth
				5 = {
					leader_event = {
						id = trime.117
						days = 1
						random = 900
					}
				}
				# disable megastructure
				10 = {
					leader_event = {
						id = trime.118
						days = 1
						random = 900
					}
				}
				# situation speed
				5 = {
					leader_event = {
						id = trime.119
						days = 1
						random = 900
					}
				}
				# sheep speed
				#5 = { leader_event = { id = paragon.40120 days = 1 random = 900 } } # production up
				160 = {
				}
			}
		}
	}
}

# age leader
leader_event = {
	id = trime.114
	title = trime.114.name
	desc = trime.114.desc
	picture = GFX_evt_smear_campaign
	show_sound = event_default
	is_triggered_only = yes
	#fire_only_once = yes
	event_window_type = leader_story
	event_picture_background = "GFX_leader_recruitment_bg_trime_timelord"
	picture_event_data = {
		portrait = root
	}
	immediate = {
		owner = {
			random_owned_leader = {
			limit = {
				leader_age > 10
			}
			save_event_target_as = trime_bullyhim
		}
		}
		
	}
	option = {
		name = trime.114.a
		event_target:trime_bullyhim = {
			add_age = 40
		}
	}
	option = {
		name = trime.114.b
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = influence
					value > 100
				}
			}
		}
		owner = {
			add_resource = {
				influence = -100
			}
		}
	}
}


