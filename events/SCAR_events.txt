namespace = scar
#change planet assets, used in system init
planet_event = {
	id = scar.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
	}
	immediate = {
		set_planet_entity = {
			entity = "treasure_planet_01_entity"
			atmosphere_color = {
				0.75
				0.1
				0.6
			}
			#DONE
			atmosphere_intensity = 1
			atmosphere_width = 0.5
		}
	}
}

### stealer of relics events
# on game start
# create leader to copy
event = {
	id = scar.199
	hide_window = yes
	is_triggered_only = yes
	trigger = {
	}
	immediate = {
		create_country = {
			name = "NAME_scar_stealer_of_relics"
			type = global_event
			auto_delete = no
			flag = {
				icon = {
					category = "special"
					file = "unknown.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"red"
					"red"
					"null"
					"null"
				}
			}
			effect = {
				save_global_event_target_as = scar_stealer_country
			}
		}
		event_target:scar_stealer_country = {
			create_species = {
				name = "NAME_scar_stealer_of_relics"
				class = RANDOM
				portrait = RANDOM
				namelist = "PRT1"
				traits = {
					trait = trait_decadent
					trait = trait_talented
					trait = trait_thrifty
					#trait = trait_weak
					#trait = trait_plantoid_budding
				}
				effect = {
					save_event_target_as = scar_stealer_species
				}
			}
			create_leader = {
				species = event_target:scar_stealer_species
				event_leader = yes
				class = commander
				name = "NAME_scar_stealer_of_relics"
				skill = 8
				randomize_traits = yes
				skip_background_generation = no
				#background_ethic = ethic_authoritarian
				#custom_catch_phrase = trime_time_lord_catchphrase
				#custom_description = trime_time_lord_backstory
				can_manually_change_location = no
				#traits = {				
				#}
				gender = male
				set_age = 64
				immortal = yes
				effect = {
					exile_leader_as = scar_stealer_of_relics
					save_global_event_target_as = scar_stealer_of_relics
					set_owner = event_target:scar_stealer_country
				}
			}
		}
		every_playable_country = {
			establish_communications_no_message = event_target:scar_stealer_country
			set_hostile = event_target:scar_stealer_country
		}
	}
	after = {
		hidden_effect = {
			# maybe keep the country for later?
			#event_target:scar_stealer_country = {
			#	destroy_country = yes
			#}
		}
	}
}

# This = Country
#dummy event to test
country_event = {
	id = scar.99
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = this
		exists = event_target:scar_stealer_country
		#mid_game_years_passed >= 0
		NOT = {
			has_global_flag = scar_defeated_relic_stealer
		}
		NOT = {
			has_global_flag = scar_stealer_currently_raiding
		}
		NOT = {
			is_same_value = event_target:scar_stealer_country
		}
	}
	immediate = {
		country_event = {
			id = scar.101
		}
		#create_fallen_empire_fleet = yes
		#last_created_fleet = {
		#	set_owner = this
		#}
		every_owned_fleet = {
			create_pirate_ships_7 = yes
			create_pirate_ships_7 = yes
			create_pirate_ships_7 = yes			
		}
		add_relic = r_celestial_tear
	}
}

# This = Country
#on_relic_received, 5% that stealer of relics spawns and attacks
country_event = {
	id = scar.100
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = this
		exists = event_target:scar_stealer_country
		mid_game_years_passed >= 0
		NOT = {
			has_global_flag = scar_defeated_relic_stealer
		}
		NOT = {
			is_same_value = event_target:scar_stealer_country
		}
	}
	immediate = {
		country_event = {
			id = scar.101
		}
	}
}

# wanna sell some relics? message
country_event = {
	id = scar.101
	title = scar.101.name
	desc = scar.101.desc
	picture = GFX_evt_communication_event
	show_sound = event_air_raid_siren
	#location = event_target:trime_primitive_rewind_world
	is_triggered_only = yes
	diplomatic_title = BLANK_STRING
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:scar_stealer_of_relics
		room = enclave_trader_room
		#planet_background = pc_city
	}
	immediate = {
	}
	option = {
		#yes
		name = scar.101.a
		event_target:scar_stealer_country = {
			steal_relic = {
				target = root
				relic = RANDOM
			}
		}
		if = {
			limit = {
				host_has_dlc = "Ancient Relics Story Pack"
			}
			add_resource = {
				minor_artifacts = 1000
			}
		}
		else = {
			add_monthly_resource_mult = {
				resource = society_research
				value = 24
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = 12
			}
		}
		#scar_give_random_archeotech = yes 
		# why doesnt this work?
	}
	option = {
		#no
		name = scar.101.b
		add_resource = {
			influence = 100
		}
		hidden_effect = {
			set_global_flag = scar_stealer_currently_raiding
			country_event = {
				# spawn fleet and make them really mad
				id = scar.102
				days = 90
			}
			country_event = {
				# notify owner of incoming fleet
				id = scar.103
				days = 30
			}
		}
	}
}

# This = Country
# delcine buy offer, send a big pirate fleet
country_event = {
	id = scar.102
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = this
	}
	immediate = {
		root.capital_scope = {
			save_event_target_as = scar_stealer_country_target_planet
		}
		event_target:scar_stealer_country = {
			enable_special_project = {
				name = scar_pirate_steal_relic_project
				location = root.capital_scope
				owner = this
			}
			set_hostile = root
			create_fleet = {
				name = "NAME_scar_big_pirate_fleet"
				settings = {
					spawn_debris = no
					#is_boss = yes
				}
				effect = {
					set_owner = PREV
					create_pirate_ships_7 = yes
					set_location = {
						target = root.capital_scope
						distance = 300
						angle = 45
						direction = in_system
					}
					set_fleet_stance = aggressive
					set_aggro_range = 600
					set_aggro_range_measure_from = self
					set_fleet_bombardment_stance = armageddon
					fleet_action_research_special_project = {
						special_project = scar_pirate_steal_relic_project
						target = root.capital_scope
					}
					#set_event_locked = yes
					set_fleet_flag = scar_big_pirate_fleet
				}
			}
		}
	}
}

# incoming pirates
country_event = {
	id = scar.103
	title = scar.103.name
	desc = scar.103.desc
	picture = GFX_evt_pirate_armada
	show_sound = event_sensor_ping
	location = this.capital_scope.solar_system
	is_triggered_only = yes
	immediate = {
	}
	option = {
		#worry
		name = WORRYING
	}
}

# pirate completed project, stole relic notifcation
# scope: pirate country
country_event = {
	id = scar.104
	title = scar.104.name
	desc = scar.104.desc
	picture = GFX_evt_pirates_attacking_cargo
	show_sound = event_ship_explosion
	location = this.capital_scope.solar_system
	is_triggered_only = yes
	immediate = {
		remove_global_flag = scar_stealer_currently_raiding
	}
	option = {
		name = CURSES
	}
	after = {
		if = {
			limit = {
				NOT = {
					has_global_flag = scar_treasure_island_spawned
				}
			}
			enable_special_project = {
				name = scar_find_pirates_system
				owner = this
			}
		}
		event_target:scar_stealer_country = {
			steal_relic = {
				target = root
				relic = RANDOM
			}
		}
		hidden_effect = {
			event_target:scar_stealer_country = {
				every_owned_fleet = {
					delete_fleet = this
				}
				if = {
					limit = {
						has_global_flag = scar_treasure_island_spawned
					}
					event_target:scar_stealer_country = {
						create_fleet = {
							name = "NAME_scar_dreadnought_fleet"
							settings = {
								spawn_debris = no
								is_boss = yes
							}
							effect = {
								set_owner = PREV
								create_ship = {
									name = scar_Bobbington
									design = scar_Bobbington
									#scar_Bobbington
								}
								set_location = {
									target = event_target:scar_treasure_island
									distance = 100
									angle = 45
									direction = in_system
								}
								set_fleet_stance = aggressive
								set_aggro_range = 600
								set_aggro_range_measure_from = self
								set_fleet_bombardment_stance = armageddon
								set_fleet_flag = scar_dreadnought_fleet
							}
						}
						set_leader = event_target:scar_stealer_of_relics
					}
				}
			}
		}
	}
}

# This = owner of fleet 1 (combatant)
# From = owner of fleet 2 (destroyed)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
# check if relic stealer fleet got destroyed either the first wave or the actual dreadnaought
country_event = {
	id = scar.105
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = this
		fromfromfrom = {
			OR = {
				has_fleet_flag = scar_big_pirate_fleet
				has_fleet_flag = scar_dreadnought_fleet
			}
		}
	}
	immediate = {
		if = {
			limit = {
				fromfromfrom = {
					has_fleet_flag = scar_big_pirate_fleet
				}
			}
			this = {
				country_event = {
					id = scar.106
					days = 30
				}
			}
		}
		else = {
			this = {
				remove_global_flag = scar_stealer_currently_raiding
				set_global_flag = scar_defeated_relic_stealer
				country_event = {
					id = scar.107
				}
			}
		}
	}
}

# incoming dreadnought with support pirate fleets
country_event = {
	id = scar.106
	title = scar.106.name
	desc = scar.106.desc
	picture = GFX_evt_clocks
	show_sound = event_encrypted_comms
	location = this.capital_scope.solar_system
	is_triggered_only = yes
	diplomatic_title = BLANK_STRING
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:scar_stealer_of_relics
		room = enclave_trader_room
		#planet_background = pc_city
	}
	trigger = {
		exists = event_target:scar_stealer_country
	}
	immediate = {
		root.capital_scope = {
			save_event_target_as = scar_stealer_country_target_planet
		}
		event_target:scar_stealer_country = {
			enable_special_project = {
				name = scar_pirate_steal_relic_project
				location = root.capital_scope
				owner = this
			}
			create_fleet = {
				name = "NAME_scar_medium_pirate_fleet"
				settings = {
					spawn_debris = no
					#is_boss = yes
				}
				effect = {
					set_owner = PREV
					create_pirate_ships_5 = yes
					set_location = {
						target = root.capital_scope
						distance = 400
						angle = 0
						direction = in_system
					}
					set_fleet_stance = aggressive
					set_aggro_range = 600
					set_aggro_range_measure_from = self
					set_fleet_bombardment_stance = armageddon
					fleet_action_research_special_project = {
						special_project = scar_pirate_steal_relic_project
						target = root.capital_scope
					}
					#set_event_locked = yes
					#set_fleet_flag = scar_big_pirate_fleet
				}
			}
			create_fleet = {
				name = "NAME_scar_medium_pirate_fleet"
				settings = {
					spawn_debris = no
					#is_boss = yes
				}
				effect = {
					set_owner = PREV
					create_pirate_ships_5 = yes
					set_location = {
						target = root.capital_scope
						distance = 400
						angle = 90
						direction = in_system
					}
					set_fleet_stance = aggressive
					set_aggro_range = 600
					set_aggro_range_measure_from = self
					set_fleet_bombardment_stance = armageddon
					fleet_action_research_special_project = {
						special_project = scar_pirate_steal_relic_project
						target = root.capital_scope
					}
					#set_event_locked = yes
					#set_fleet_flag = scar_big_pirate_fleet
				}
			}
			create_fleet = {
				name = "NAME_scar_dreadnought_fleet"
				settings = {
					spawn_debris = no
					is_boss = yes
				}
				effect = {
					set_owner = PREV
					create_ship = {
						name = scar_Bobbington
						design = scar_Bobbington
						#scar_Bobbington
					}
					set_location = {
						target = root.capital_scope
						distance = 500
						angle = 45
						direction = in_system
					}
					set_fleet_stance = aggressive
					set_aggro_range = 600
					set_aggro_range_measure_from = self
					set_fleet_bombardment_stance = armageddon
					fleet_action_research_special_project = {
						special_project = scar_pirate_steal_relic_project
						target = root.capital_scope
					}
					#set_event_locked = yes
					set_fleet_flag = scar_dreadnought_fleet
				}
			}
		}
	}
	option = {
		#worry
		name = scar.106.a
	}
}

# on dreadnaught defeat
country_event = {
	id = scar.107
	title = scar.107.name
	desc = scar.107.desc
	picture = GFX_evt_debris
	show_sound = event_space_battle
	#location = this.capital_scope.solar_system
	is_triggered_only = yes
	immediate = {
	}
	option = {
		#yippie defeated pirates
		name = scar.107.a
	}
	after = {
		hidden_effect = {
			event_target:scar_stealer_country = {
				destroy_country = yes
			}
		}
	}
}

# on special project complete, found treasure island
country_event = {
	id = scar.108
	title = scar.108.name
	desc = scar.108.desc
	picture = GFX_evt_treasure_pile
	show_sound = event_finding_loot
	location = event_target:scar_treasure_island
	is_triggered_only = yes
	immediate = {
	}
	option = {
		#yippie found system
		name = scar.108.a
	}
}
